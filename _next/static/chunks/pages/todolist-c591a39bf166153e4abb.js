(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[815],{7515:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Y}});var r=n(2322),i=n(6422),o=n(8079),s=n(2784),c=n(5292),a=n(3698),u=n(436),h=n(3035),l=n(1155),f=n(7556),d=n(7390),p=n(7485),v=n(5584),m=n(1256),y=n(8987),g=n(9571),b=n(4317),w=n(9692),x=n(9556);(0,w.Z)({});function j(e){var t=e.chunks.map((function(e){return{id:e.id,shortId:k(e.id),type:e.type,size:e.size}}));return(0,r.jsx)(m.Z,{component:f.Z,children:(0,r.jsxs)(d.Z,{size:"small",stickyHeader:!0,"aria-label":"a dense table",children:[(0,r.jsx)(y.Z,{children:(0,r.jsxs)(g.Z,{children:[(0,r.jsx)(v.Z,{children:"UUID"}),(0,r.jsx)(v.Z,{align:"right",children:"Type"}),(0,r.jsx)(v.Z,{align:"right",children:"Size"})]})}),(0,r.jsx)(p.Z,{children:t.map((function(e){return(0,r.jsxs)(g.Z,{children:[(0,r.jsx)(v.Z,{component:"th",scope:"row",children:(0,r.jsxs)(a.Z,{display:"flex",flexDirection:"row",justifyContent:"space-between",children:[(0,r.jsx)(b.ZP,{title:e.id,"aria-label":"Chunk ID",children:(0,r.jsx)("span",{children:e.shortId})}),(0,r.jsx)(l.Z,{"aria-label":"Edit",size:"small",edge:"end",onClick:function(){return function(e){var t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}(e.id)},children:(0,r.jsx)(x.Z,{fontSize:"small"})})]})}),(0,r.jsx)(v.Z,{align:"right",children:e.type}),(0,r.jsx)(v.Z,{align:"right",children:e.size})]},e.id)}))})]})})}function k(e){return e?e.substr(0,13)+"..."+e.substr(28):e}var S=n(3434),P=n(4339),Z=n(4579),C=n(2552),E=n(8069),T=(0,w.Z)({root:{width:"100%"}});function D(e){var t=e.space,n=T();return t?(0,r.jsxs)(P.Z,{className:n.root,children:[(0,r.jsx)(C.Z,{avatar:(0,r.jsx)(S.Z,{"aria-label":"recipe",children:"S"}),title:t.name,subheader:t.id}),(0,r.jsxs)(Z.Z,{children:[(0,r.jsxs)(u.Z,{gutterBottom:!0,component:"div",children:["Description:",t.description?(0,r.jsx)(a.Z,{children:t.description}):(0,r.jsx)(a.Z,{children:(0,r.jsx)("i",{children:"(empty)"})})]}),(0,r.jsx)(m.Z,{component:f.Z,children:(0,r.jsx)(d.Z,{size:"small",stickyHeader:!0,"aria-label":"a dense table",children:(0,r.jsx)(p.Z,{children:(0,r.jsxs)(g.Z,{children:[(0,r.jsx)(v.Z,{component:"th",scope:"row",children:"Ref:"}),(0,r.jsx)(v.Z,{align:"right",children:t.ref})]})})})})]})]}):(0,r.jsxs)(P.Z,{className:n.root,children:[(0,r.jsx)(C.Z,{avatar:(0,r.jsx)(E.Z,{animation:"wave",variant:"circle",width:40,height:40}),title:(0,r.jsx)(E.Z,{animation:"wave",height:20,width:"40%"}),subheader:(0,r.jsx)(E.Z,{animation:"wave",height:20,width:"50%"})}),(0,r.jsxs)(Z.Z,{children:[(0,r.jsxs)(u.Z,{gutterBottom:!0,children:["Description: ",(0,r.jsx)(E.Z,{animation:"wave",component:"span",height:24,width:"100px"})]}),(0,r.jsx)(m.Z,{component:f.Z,children:(0,r.jsxs)(d.Z,{size:"small",stickyHeader:!0,"aria-label":"a dense table",children:[(0,r.jsx)(y.Z,{children:(0,r.jsxs)(g.Z,{children:[(0,r.jsx)(v.Z,{children:"Ref"}),(0,r.jsx)(v.Z,{align:"right",children:"Chunk"})]})}),(0,r.jsx)(p.Z,{children:(0,r.jsxs)(g.Z,{children:[(0,r.jsx)(v.Z,{component:"th",scope:"row",children:(0,r.jsx)(E.Z,{animation:"wave",component:"span",height:20,width:"40%"})}),(0,r.jsx)(v.Z,{align:"right",children:(0,r.jsx)(E.Z,{animation:"wave",component:"span",height:20,width:"90%"})})]})})]})})]})]})}var _=(0,c.makeSpaceID)("space"),L=function(e){var t=e.db;return t=t||(0,o.zh)(),(0,r.jsx)(o.gt,{value:t,children:(0,r.jsx)(O,{})})},O=function(){var e=(0,o.zh)(),t=(0,o.Ke)(_,"todos",1/0),n=(0,o.$_)(_),i=(null===e||void 0===e?void 0:e.storage.chunks.size)||0;return(0,r.jsxs)(a.Z,{display:"flex",alignItems:"stretch",flexDirection:"column",children:[(0,r.jsx)(a.Z,{m:1,children:(0,r.jsx)(u.Z,{component:"h1",variant:"h2",children:"Tech data"})}),(0,r.jsx)(a.Z,{m:1,children:(0,r.jsx)(D,{space:n})}),(0,r.jsx)(a.Z,{m:1,children:(0,r.jsxs)(h.Z,{severity:"info",variant:"outlined",children:["Total chunks in storage: ",i]})}),(0,r.jsx)(a.Z,{m:1,children:(0,r.jsx)(j,{chunks:t})})]})},I=n(6942),R=n(4614),z=new c.Model("todos",{uuid:"_id",sid:null,indexes:{},factory:function(e){return e}});var N=n(8103),M=n(5549),A=function(e){var t=e.saveTodo,n=function(){var e=(0,s.useState)(""),t=e[0],n=e[1];return{value:t,onChange:function(e){n(e.target.value)},reset:function(){return n("")}}}(),i=n.value,o=n.reset,c=n.onChange;return(0,r.jsx)("form",{onSubmit:function(e){e.preventDefault(),i.trim()&&t(i),o()},children:(0,r.jsxs)(a.Z,{alignItems:"bottom",children:[(0,r.jsx)(N.Z,{size:"small",placeholder:"Add todo",margin:"normal",onChange:c,value:i}),(0,r.jsx)(l.Z,{"aria-label":"Delete",type:"submit",disabled:!i.trim(),children:(0,r.jsx)(M.Z,{})})]})})},B=n(3092),F=n(2983),U=n(7604),q=function(e){var t=e.todos,n=e.deleteTodo,i=e.loading;return(0,r.jsx)(a.Z,{m:1,children:(0,r.jsx)(m.Z,{component:f.Z,children:(0,r.jsxs)(d.Z,{size:"small","aria-labelledby":"tableTitle","aria-label":"enhanced table",children:[(0,r.jsx)(y.Z,{children:(0,r.jsxs)(g.Z,{children:[(0,r.jsx)(v.Z,{}),(0,r.jsx)(v.Z,{children:"Todo"}),(0,r.jsx)(v.Z,{align:"right",children:"Actions"})]})}),(0,r.jsxs)(p.Z,{children:[!i&&t.map((function(e){return(0,r.jsxs)(g.Z,{children:[(0,r.jsx)(v.Z,{padding:"checkbox",children:(0,r.jsx)(B.Z,{checked:!1,inputProps:{"aria-labelledby":"labelId"}})}),(0,r.jsx)(v.Z,{children:e.title}),(0,r.jsxs)(v.Z,{align:"right",children:[(0,r.jsx)(l.Z,{size:"small","aria-label":"Edit",onClick:function(){n(e._id)},children:(0,r.jsx)(U.Z,{})}),(0,r.jsx)(l.Z,{size:"small","aria-label":"Delete",onClick:function(){n(e._id)},children:(0,r.jsx)(F.Z,{})})]})]},e._id)})),i&&[0,1,2,3,4].map((function(e){return(0,r.jsxs)(g.Z,{children:[(0,r.jsx)(v.Z,{padding:"checkbox",children:(0,r.jsx)(B.Z,{checked:!0,inputProps:{"aria-labelledby":"labelId"},disabled:!0})}),(0,r.jsx)(v.Z,{children:(0,r.jsx)(E.Z,{animation:"wave",component:"span",height:24,width:"40%"})}),(0,r.jsxs)(v.Z,{align:"right",children:[(0,r.jsx)(l.Z,{size:"small","aria-label":"Edit",disabled:!0,children:(0,r.jsx)(U.Z,{})}),(0,r.jsx)(l.Z,{size:"small","aria-label":"Delete",disabled:!0,children:(0,r.jsx)(F.Z,{})})]})]},e)}))]})]})})})},G=function(){var e=function(){var e=(0,o.zh)();return(0,s.useCallback)((function(t){var n=t.trim();if(n){var r={_id:Math.random().toString(16).substring(2),title:n};e.transaction((0,c.makeSpaceID)("space"),(function(e){return e.upsert(z,r)})).then((function(){return console.log("transaction complete")}))}}),[e])}(),t=function(){var e=(0,o.zh)();return(0,s.useCallback)((function(t){t&&e.transaction((0,c.makeSpaceID)("space"),(function(e){return e.remove(z,t)})).then((function(){return console.log("transaction complete")}))}),[e])}(),n=(0,o.hT)((0,c.makeSpaceID)("space"),(function(e){return e.collection(z).find({})})),i=(0,I.Z)(n,2),l=i[0],f=i[1],d=(0,o.hT)((0,c.makeSpaceID)("space"),(function(e){return e.collection(z).find({}).exec().reduce((function(e,t){return e+t.title.length}),0)})),p=(0,I.Z)(d,2),v=p[0],m=p[1];return(0,r.jsxs)(a.Z,{display:"flex",alignItems:"stretch",flexDirection:"column",m:1,children:[(0,r.jsxs)(a.Z,{m:1,children:[(0,r.jsx)(u.Z,{component:"h1",variant:"h2",children:"Todos"}),(0,r.jsx)(A,{saveTodo:e}),(0,r.jsxs)(h.Z,{severity:"info",variant:"outlined",children:["Total symbols in titles:\xa0",m?(0,r.jsx)(R.Z,{size:12}):v]})]}),(0,r.jsx)(q,{todos:l,deleteTodo:t,loading:f})]})},H=new(n(7648).s)("chunk-db-todolist-example"),$=new c.Space({id:"space",name:"a1",ref:null}),K=new c.ChunkDB({storage:H,collections:[z]});K.connect().then((function(e){console.log("connected"),e.spaces.load($.id).catch((function(){return e.spaces.create($),e.spaces.save($.id)})).then((function(e){return $=e})).then((function(){return console.log("init spaces",e.spaces)}))}));var Y=function(){var e=(0,s.useState)(null),t=e[0],n=e[1];return(0,s.useEffect)((function(){var e=document.querySelector("#jss-server-side");e&&e.parentElement.removeChild(e)}),[]),(0,s.useEffect)((function(){var e=setTimeout((function(){console.log("-= Set DB for DevTools =-"),n(K)}),1e3);return function(){return clearTimeout(e)}})),(0,r.jsxs)("div",{className:"jsx-2573782864 app",children:[(0,r.jsx)("div",{className:"jsx-2573782864 todolist-container",children:(0,r.jsx)(o.gt,{value:K,children:(0,r.jsx)(G,{})})}),(0,r.jsx)("div",{className:"jsx-2573782864 devtools-container",children:(0,r.jsx)(L,{db:t})}),(0,r.jsx)(i.default,{id:"2573782864",children:[".app.jsx-2573782864{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:900px;margin:10px auto;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}",".todolist-container.jsx-2573782864{-webkit-flex:1 1 50%;-ms-flex:1 1 50%;flex:1 1 50%;}",".devtools-container.jsx-2573782864{-webkit-flex:1 1 50%;-ms-flex:1 1 50%;flex:1 1 50%;}"]})]})}},3354:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/todolist",function(){return n(7515)}])},5292:function(e,t,n){var r,i,o=n(2717);function s(e){var t=new Map;return Object.keys(e).forEach((function(n){return t.set(n,c(e[n]))})),t}function c(e){return new Map(Object.keys(e).map((function(t){return[t,e[t]]})))}function a(e){return new Map(e.map((function(e){return[e._id,e]})))}function u(e){if("object"!=typeof e||!e)return!1;var t=e.data;return!!Array.isArray(e.parents)&&"object"==typeof t}function h(e){var t=0,n={};return e.forEach((function(e,r){n[r]=e.size,t+=e.size})),{size:t,sizes:n}}(r=t.Priority||(t.Priority={}))[r.Low=1]="Low",r[r.Normal=2]="Normal",r[r.High=3]="High",(i=t.ChunkType||(t.ChunkType={})).Unknown="",i.Snapshot="snapshot",i.Incremental="incremental",i.Update="update",i.Merge="merge",i.Draft="draft",i.TemporaryTransaction="temporary-transaction";var l=function(){function e(e){this.id="",this.size=0,this.sizes={},this.id=e.id||"",this.parents=e.parents.map((function(e){return e})),this.data=s(e.data);var t=h(this.data),n=t.sizes;this.size=t.size,this.sizes=n}return e.prototype.toGenericChunk=function(){var e={};return this.data.forEach((function(t,n){var r={};t.forEach((function(e,t){return r[t]=e})),e[n]=r})),{id:this.id,type:this.type,parents:this.parents.slice(),data:e}},e}();function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return t&&f(e.prototype,t),n&&f(e,n),e}function p(){return(p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function v(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,y(e,t)}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(r){return!1}}function b(e,t,n){return(b=g()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&y(i,n.prototype),i}).apply(null,arguments)}function w(e){var t="function"==typeof Map?new Map:void 0;return(w=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return b(e,arguments,m(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),y(n,e)})(e)}var x=function(e){function n(n){var r;if((r=e.call(this,n)||this).type=t.ChunkType.Incremental,!r.data.size)throw new Error("Incremental chunk can not be empty");return r}return v(n,e),n}(l),j=function(e){function n(n){var r;return(r=e.call(this,n)||this).type=t.ChunkType.Snapshot,r}return v(n,e),n}(l);function k(e){if(!u(e))throw new Error("Invalid chunk");switch(e.type){case t.ChunkType.Snapshot:return new j(e);case t.ChunkType.TemporaryTransaction:case t.ChunkType.Incremental:default:return new x(e)}}var S=function(e){function n(n){var r;return(r=e.call(this,n)||this).type=t.ChunkType.Merge,r.commonChunk="",r}return v(n,e),n}(l),P=function(e){function n(n,r){var i;return(i=e.call(this,{id:n,type:t.ChunkType.TemporaryTransaction,parents:r?[r]:[],data:{}})||this).type=t.ChunkType.TemporaryTransaction,i.data=new Map,i}v(n,e);var r=n.prototype;return r.hasRecords=function(e,t){var n=this.data.get(e.name)||new Map;return!!n&&n.has(t)},r.setRecord=function(e,t,n){var r=this.data.get(e.name)||new Map;r.set(t,n),this.data.set(e.name,r)},r.setRecords=function(e,t){this.data.set(e.name,a(t))},n}(l),Z=function(e){function n(){var n;return(n=e.apply(this,arguments)||this).type=t.ChunkType.Update,n}return v(n,e),n}(l),C=function(e){function t(){return e.apply(this,arguments)||this}return v(t,e),t}(w(Error)),E=function(e){function t(){return e.apply(this,arguments)||this}return v(t,e),t}(w(Error)),T=function(e){function t(t){return e.call(this,'Space "'+t+'" not found')||this}return v(t,e),t}(C),D=function(e){function t(t){return e.call(this,'Chunk "'+t+'" not found in storage')||this}return v(t,e),t}(w(Error)),_=function(){function e(e){this.driver=e,this.chunks=new Map,this.spaces=new Map}var n=e.prototype;return n.connect=function(){var e=this;return this.driver.connect?this.driver.connect().then((function(){return e})):Promise.resolve(this)},n.getExists=function(e){var t=this.chunks.get(e);return t?"then"in t?null:t:null},n.saveChunk=function(e){try{return this.chunks.set(e.id,e),Promise.resolve(this.driver.saveChunk(e.toGenericChunk())).then((function(){return e}))}catch(e){return Promise.reject(e)}},n.saveTemporalChunk=function(e){return this.chunks.set(e.id,e),e},n.removeTemporalChunk=function(e){var n=this.chunks.get(e);return!n||"then"in n||n.type===t.ChunkType.TemporaryTransaction&&(this.chunks.delete(e),!0)},n.loadChunk=function(e){try{var t=this;if(!e)throw new D(e);var n=t.chunks.get(e);if(n)return Promise.resolve(n);var r=t.driver.loadChunk(e).then((function(n){var r=k(n);return t.chunks.set(e,r),r}));return t.chunks.set(e,r),Promise.resolve(r)}catch(e){return Promise.reject(e)}},n.saveSpace=function(e){return this.spaces.set(e.id,e),this.driver.saveSpace(e)},n.loadSpace=function(e){try{return Promise.resolve(this.driver.loadSpace(e)).then((function(t){if(!t)throw new T(e);return t}))}catch(e){return Promise.reject(e)}},e}();function L(e,t,n){if(!e.s){if(n instanceof O){if(!n.s)return void(n.o=L.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(L.bind(null,e,t),L.bind(null,e,2));e.s=t,e.v=n;var r=e.o;r&&r(e)}}var O=function(){function e(){}return e.prototype.then=function(t,n){var r=new e,i=this.s;if(i){var o=1&i?t:n;if(o){try{L(r,1,o(this.v))}catch(e){L(r,2,e)}return r}return this}return this.o=function(e){try{var i=e.v;1&e.s?L(r,1,t?t(i):i):n?L(r,1,n(i)):L(r,2,i)}catch(e){L(r,2,e)}},r},e}();function I(e){return e instanceof O&&1&e.s}function R(e,t,n){for(var r;;){var i=e();if(I(i)&&(i=i.v),!i)return o;if(i.then){r=0;break}var o=n();if(o&&o.then){if(!I(o)){r=1;break}o=o.s}if(t){var s=t();if(s&&s.then&&!I(s)){r=2;break}}}var c=new O,a=L.bind(null,c,2);return(0===r?i.then(h):1===r?o.then(u):s.then(l)).then(void 0,a),c;function u(r){o=r;do{if(t&&(s=t())&&s.then&&!I(s))return void s.then(l).then(void 0,a);if(!(i=e())||I(i)&&!i.v)return void L(c,1,o);if(i.then)return void i.then(h).then(void 0,a);I(o=n())&&(o=o.v)}while(!o||!o.then);o.then(u).then(void 0,a)}function h(e){e?(o=n())&&o.then?o.then(u).then(void 0,a):u(o):L(c,1,o)}function l(){(i=e())?i.then?i.then(h).then(void 0,a):h(i):L(c,1,o)}}var z=function(){function e(e){this.querySelector=e,this._done=!1}var t=e.prototype;return t.one=function(){try{var e=this,t=function(){return e._done=!0,n},n=null,r=R((function(){return!e.querySelector.done||!n}),void 0,(function(){return Promise.resolve(e.querySelector.next()).then((function(e){var t=e.records;t&&t.size&&(n=Array.from(t.values())[0])}))}));return Promise.resolve(r&&r.then?r.then(t):t())}catch(e){return Promise.reject(e)}},t.all=function(){try{var e=this,t=function(){return e._done=!0,Array.from(n.values()).filter((function(e){return!!e}))};if(e._done)throw new Error("Cursor already complete");var n=new Map,r=R((function(){return!e.querySelector.done}),void 0,(function(){return Promise.resolve(e.querySelector.next()).then((function(e){var t=e.records;t&&t.forEach((function(e,t){return!n.has(t)&&n.set(t,e)}))}))}));return Promise.resolve(r&&r.then?r.then(t):t())}catch(e){return Promise.reject(e)}},t.reduce=function(e,t){try{var n=this,r=function(){return n._done=!0,i};if(n._done)throw new Error("Cursor already complete");var i=t,o=R((function(){return!n.querySelector.done}),void 0,(function(){return Promise.resolve(n.querySelector.next()).then((function(t){var n=t.records;n&&n.forEach((function(t){t&&(i=e(i,t))}))}))}));return Promise.resolve(o&&o.then?o.then(r):r())}catch(e){return Promise.reject(e)}},d(e,[{key:"done",get:function(){return this._done}}]),e}();!function(e){var t=function(e){var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function a(e,t,n,r){var i=Object.create((t&&t.prototype instanceof l?t:l).prototype),o=new k(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return{value:void 0,done:!0}}for(n.method=i,n.arg=o;;){var s=n.delegate;if(s){var c=w(s,n);if(c){if(c===h)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var a=u(e,t,n);if("normal"===a.type){if(r=n.done?"completed":"suspendedYield",a.arg===h)continue;return{value:a.arg,done:n.done}}"throw"===a.type&&(r="completed",n.method="throw",n.arg=a.arg)}}}(e,n,o),i}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=a;var h={};function l(){}function f(){}function d(){}var p={};p[i]=function(){return this};var v=Object.getPrototypeOf,m=v&&v(v(S([])));m&&m!==t&&n.call(m,i)&&(p=m);var y=d.prototype=l.prototype=Object.create(p);function g(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){var r;this._invoke=function(i,o){function s(){return new t((function(r,s){!function r(i,o,s,c){var a=u(e[i],e,o);if("throw"!==a.type){var h=a.arg,l=h.value;return l&&"object"==typeof l&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):t.resolve(l).then((function(e){h.value=e,s(h)}),(function(e){return r("throw",e,s,c)}))}c(a.arg)}(i,o,r,s)}))}return r=r?r.then(s,s):s()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return h;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var r=u(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,h;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function S(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:P}}function P(){return{value:void 0,done:!0}}return f.prototype=y.constructor=d,d.constructor=f,f.displayName=c(d,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,c(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},g(b.prototype),b.prototype[o]=function(){return this},e.AsyncIterator=b,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var s=new b(a(t,n,r,i),o);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},g(y),c(y,s,"Generator"),y[i]=function(){return this},y.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=S,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(j),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return s.type="throw",s.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=n.call(o,"catchLoc"),a=n.call(o,"finallyLoc");if(c&&a){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),j(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;j(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:S(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),h}},e}({});try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}();var N={$eq:function(e){return function(t){return t===e}},$gt:function(e){return function(t){return t>e}},$gte:function(e){return function(t){return t>=e}},$lt:function(e){return function(t){return t<e}},$lte:function(e){return function(t){return t<=e}}};function M(e){if("object"!=typeof e)throw new Error("ConditionValidator must be an object");var t=Object.keys(e).map((function(t){var n,r;return{getter:function(e){var t=Array.isArray(e)?e:e.split(".");return function(e){for(var n=e,r=0;r<t.length;r++){if("object"!=typeof n||!n)return;var i=t[r];if(!(i in n))return;n=n[i]}return n}}(t),conditions:(r="object"==typeof(n=e[t])?n:{$eq:n},Object.keys(r).map((function(e){var t=e;if(!(t in N))throw new A('Unknown operator "'+t+'"');return N[t](r[t])})))}}));return function(e){return t.every((function(t){var n=t.conditions,r=(0,t.getter)(e);return n.every((function(e){return e(r)}))}))}}var A=function(e){function t(t,n,r){var i;return(i=e.call(this,t)||this).path=n,i.query=r,i}return v(t,e),t}(w(Error)),B=Symbol("Call");function F(e){var t;return(t={})[B]=!0,t.action=e,t.args=[].slice.call(arguments,1),t}var U=function(e){try{var t=this;return Promise.all(e.map((function(e){return t.storage.loadChunk(e).then((function(t){if(!t)throw new D(e);return t}))})))}catch(e){return Promise.reject(e)}};function q(e){return e()}var G=regeneratorRuntime.mark(H);function H(e,n,r){var i,o,s,c,a,u,h;return regeneratorRuntime.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:return void 0===r&&(r={}),i=new Map,o=M(r),l.next=5,F(q,e);case 5:if(c=l.sent){l.next=8;break}return l.abrupt("return",{chunkIDs:c});case 8:a=$(i,o),u=regeneratorRuntime.mark((function e(){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F(U,c);case 2:if(s=e.sent,r=[],i=new Map,s.forEach((function(e){var o=e.data.get(n.name);switch(o&&o.forEach((function(e,t){return a(e)&&i.set(t,e)})),e.type){case t.ChunkType.Snapshot:break;case t.ChunkType.TemporaryTransaction:case t.ChunkType.Incremental:r.push.apply(r,e.parents);break;default:throw new Error('Unsupported chunk type "'+e.type+'"')}})),!r.length){e.next=12;break}return e.next=9,{chunkIDs:c,records:i};case 9:c=r,e.next=13;break;case 12:return e.abrupt("return",{v:{chunkIDs:c,records:i}});case 13:case"end":return e.stop()}}),e)}));case 10:return l.delegateYield(u(),"t0",12);case 12:if("object"!=typeof(h=l.t0)){l.next=15;break}return l.abrupt("return",h.v);case 15:l.next=10;break;case 17:case"end":return l.stop()}}),G)}function $(e,t){return function(n){return!n||!e.has(n._id)&&!!t(n)&&(e.set(n._id,n),!0)}}var K=function(){function e(e,t,n,r){this.db=e,this.delayedRefs=t,this.model=n,this.query=r,this._done=!1,this.scenario=this.db.run(H(this.delayedRefs,this.model,this.query))}return e.prototype.next=function(){try{var e=this;return Promise.resolve(e.scenario.next()).then((function(t){var n=t.value;return e._done=!!t.done,n}))}catch(e){return Promise.reject(e)}},d(e,[{key:"done",get:function(){return this._done}}]),e}(),Y=function(){function e(e,t,n,r){this.db=e,this.delayedRefs=t,this.model=n,this._query=r}return e.prototype.exec=function(){var e=new K(this.db,this.delayedRefs,this.model,this._query);return new z(e)},e}(),V=function(){function e(e,t,n){this.db=e,this.model=t,this.delayedRefs=n}var t=e.prototype;return t.find=function(e){return new Y(this.db,this.delayedRefs,this.model,e)},t.findOne=function(e){try{return Promise.resolve(this.findAll(e)).then((function(e){return e[0]||null}))}catch(e){return Promise.reject(e)}},t.findAll=function(e){return this.find(e).exec().all()},e}(),W=function(){function e(e,t){this.db=e,this.space=t,this.updatedRefs=new Map,this.refs=new Map,this.stats={deleted:[],inserted:[],updated:[],upserted:[]},this.chunks={},this.initialRefs=new Map([[t.id,t.ref]]),this.refs=new Map([[t.id,t.ref]])}var t=e.prototype;return t.getDB=function(){return this.db},t.getSpace=function(){return this.space},t.getStats=function(){return this.stats},t.collection=function(e){return new V(this.db,e,this.makeDelayedRefs(e))},t.upsert=function(e,t){try{return this.prepareSpaceForWriting(this.space.id),this.chunks[this.space.id].hasRecords(e,t[e.uuid])||this.stats.upserted.push(t[e.uuid]),this.chunks[this.space.id].setRecord(e,t[e.uuid],t),this.db.storage.saveTemporalChunk(this.chunks[this.space.id]),Promise.resolve(t)}catch(e){return Promise.reject(e)}},t.remove=function(e,t){try{return this.prepareSpaceForWriting(this.space.id),this.chunks[this.space.id].hasRecords(e,t)||this.stats.deleted.push(t),this.chunks[this.space.id].setRecord(e,t,null),this.db.storage.saveTemporalChunk(this.chunks[this.space.id]),Promise.resolve()}catch(e){return Promise.reject(e)}},t.prepareSpaceForWriting=function(e){if(!this.updatedRefs.has(e)){var t=o.v4(),n=new P(t,this.refs.get(e));this.updateRef(this.space.id,t),this.chunks[e]=n}},t.makeDelayedRefs=function(e){var t=this;return function(){return Promise.resolve([t.refs.get(t.space.id)])}},t.updateRef=function(e,t){if(!this.initialRefs.has(e))throw new E("Forbidden to write into not defined spaces");return this.initialRefs.get(e)!==t&&this.updatedRefs.get(e)!==t&&(this.updatedRefs.set(e,t),this.refs.set(e,t),!0)},e}(),Q=function(){function e(e,t){this.db=e,this.model=t}return e.prototype.space=function(e){var t=this.db.spaces.getDelayedSpaces(Array.isArray(e)?e:[e]).getRefs(this.model);return new V(this.db,this.model,t)},e}();function X(e){var t=e;return t.unsubscribe=e,t}var J=function(e,t){this.name=e,this.uuid=t.uuid,this.sid=t.sid||null,this.indexes=t.indexes,this.defaults=t.defaults||{},this.factory=t.factory},ee=function(){function e(e,t){this.db=e,this.spaceId=t}return e.prototype.collection=function(e){if(!(e instanceof J))throw new Error("Scheme must be instance of Model");if(!(e.name in this.db.collections))throw new Error('Unregistered collection "'+e.name+'"');return this.db.collections[e.name].space(this.spaceId)},d(e,[{key:"space",get:function(){return this.db.spaces.getLoaded(this.spaceId)}},{key:"description",get:function(){var e;return(null==(e=this.space)?void 0:e.description)||""}},{key:"id",get:function(){return this.spaceId}},{key:"name",get:function(){var e;return(null==(e=this.space)?void 0:e.name)||""}},{key:"ref",get:function(){var e;return(null==(e=this.space)?void 0:e.ref)||""}}]),e}(),te=function(){function e(e,t){this.spaces=e,this.spaceIDs=t}var t=e.prototype;return t.getSpaces=function(){var e=this;return Promise.all(this.spaceIDs.map((function(t){return e.spaces.isLoaded(t)?Promise.resolve(e.spaces.getLoaded(t)):e.spaces.load(t)})))},t.getRefs=function(e){var t=this;return function(){return t.getSpaces().then((function(e){return e.map((function(e){return e.ref}))}))}},e}(),ne=function(e){this.id=e.id,this.name=e.name,this.description=e.description||"",this.ref=e.ref},re=function(){function e(e){this.storage=e,this.spaces=new Map,this.subscriptions=[],this.spaceSubscriptions=new Map}var t=e.prototype;return t.create=function(e){var t=new ne({id:e.id||o.v4(),name:e.name||"some name",description:e.description,ref:e.ref||""});return this.spaces.set(t.id,t),t},t.isLoaded=function(e){return this.spaces.has(e)},t.getLoaded=function(e){return this.spaces.get(e)},t.getDelayedSpaces=function(e){return new te(this,e)},t.getList=function(){return Array.from(this.spaces.values())},t.load=function(e){var t=this;return this.storage.loadSpace(e).then((function(e){var n=new ne(e);t.spaces.set(n.id,n);var r=t.spaceSubscriptions.get(n.id);return r&&r.forEach((function(e){return e()})),n}))},t.save=function(e){var t=this.spaces.get(e);if(!t)throw new T(e);return this.storage.saveSpace(t).then((function(){return t}))},t.remove=function(e){throw new Error("not implemented")},t.updateSpaceRef=function(e,t){try{var n=this,r=n.spaces.get(e);if(!r)throw new Error('Space "'+e+'" not loaded');return n.spaces.set(e,p({},r,{ref:t})),Promise.resolve(n.storage.saveSpace(n.spaces.get(e))).then((function(){var t=n.spaceSubscriptions.get(e);t&&t.forEach((function(e){return e()}))}))}catch(e){return Promise.reject(e)}},t.subscribe=function(e,t){var n=this;if("function"==typeof e){var r=e;return this.subscriptions.push(r),X((function(){n.subscriptions=n.subscriptions.filter((function(e){return e!==r}))}))}var i=this.spaceSubscriptions.get(e)||[];return i.push(t),this.spaceSubscriptions.set(e,i),X((function(){var r=n.spaceSubscriptions.get(e)||[];n.spaceSubscriptions.set(e,r.filter((function(e){return e!==t})))}))},e}(),ie="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function oe(e,t,n){if(!e.s){if(n instanceof se){if(!n.s)return void(n.o=oe.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(oe.bind(null,e,t),oe.bind(null,e,2));e.s=t,e.v=n;var r=e.o;r&&r(e)}}var se=function(){function e(){}return e.prototype.then=function(t,n){var r=new e,i=this.s;if(i){var o=1&i?t:n;if(o){try{oe(r,1,o(this.v))}catch(e){oe(r,2,e)}return r}return this}return this.o=function(e){try{var i=e.v;1&e.s?oe(r,1,t?t(i):i):n?oe(r,1,n(i)):oe(r,2,i)}catch(e){oe(r,2,e)}},r},e}();function ce(e){return e instanceof se&&1&e.s}function ae(e,t,n){for(var r;;){var i=e();if(ce(i)&&(i=i.v),!i)return o;if(i.then){r=0;break}var o=n();if(o&&o.then){if(!ce(o)){r=1;break}o=o.s}if(t){var s=t();if(s&&s.then&&!ce(s)){r=2;break}}}var c=new se,a=oe.bind(null,c,2);return(0===r?i.then(h):1===r?o.then(u):s.then(l)).then(void 0,a),c;function u(r){o=r;do{if(t&&(s=t())&&s.then&&!ce(s))return void s.then(l).then(void 0,a);if(!(i=e())||ce(i)&&!i.v)return void oe(c,1,o);if(i.then)return void i.then(h).then(void 0,a);ce(o=n())&&(o=o.v)}while(!o||!o.then);o.then(u).then(void 0,a)}function h(e){e?(o=n())&&o.then?o.then(u).then(void 0,a):u(o):oe(c,1,o)}function l(){(i=e())?i.then?i.then(h).then(void 0,a):h(i):oe(c,1,o)}}var ue=function(){function e(e){var t=this;this.ready=!1,this.activeTransactions=[],this.storeSubscriptions=[],this.collections={},e.collections.forEach((function(e){t.collections[e.name]=new Q(t,e)})),this.storageDriver=e.storage,this.storage=new _(this.storageDriver),this.spaces=new re(this.storage)}var n=e.prototype;return n.connect=function(){var e=this;return this.storage.connect().then((function(){e.ready=!0})).then((function(){return e}))},n.subscribe=function(e,t){var n=this;return"function"==typeof e?(this.storeSubscriptions.push(e),X((function(){return n.storeSubscriptions=n.storeSubscriptions.filter((function(t){return t!==e}))}))):this.spaces.subscribe(e,t)},n.space=function(e){if(!e)throw new Error('Invalid space ""');return new ee(this,"object"==typeof e?e.id:e)},n.collection=function(e){if(e.name in this.collections)return this.collections[e.name];throw new Error('Invalid collection "'+e.name+'"')},n.run=function(e){return function(e,t){return{next:function(n){try{var r;return Promise.resolve(ae((function(){return!r}),void 0,(function(){var i=t.next(n),o=!!i.done,s=i.value;return function(e){return e&&!!e[B]}(s)?Promise.resolve(s.action.apply(e,s.args)).then((function(e){if(n=e,o)return r=1,{done:o,value:n}})):(r=1,{done:o,value:s})})))}catch(e){return Promise.reject(e)}}}}({storage:this.storage,activeTransactions:this.activeTransactions,updateSpaceRef:this.spaces.updateSpaceRef,spaces:this.spaces},e)},n.transaction=function(e,t,n){try{var r,i=this;return n?(r=n,Object.assign({restartOnFail:!1},t)):r=t,Promise.resolve(i.spaces.load(e)).then((function(t){var n=new W(i,t);return Promise.resolve(r(n)).then((function(){return Promise.resolve(i.applyTransaction(e,n)).then((function(){return n.getStats()}))}))}))}catch(e){return Promise.reject(e)}},n.getFlatChain=function(e,t){void 0===t&&(t=3);try{var n=this;if(!t||!e)return Promise.resolve([]);var r=[],i=[e],o=0,s=ae((function(){return o<t&&!!i.length}),(function(){return o++}),(function(){function e(){i=t}var t=[],o=function(e,t,n){if("function"==typeof e[ie]){var r,i,o,s=e[ie]();if(function e(n){try{for(;!(r=s.next()).done;)if((n=t(r.value))&&n.then){if(!ce(n))return void n.then(e,o||(o=oe.bind(null,i=new se,2)));n=n.v}i?oe(i,1,n):i=n}catch(e){oe(i||(i=new se),2,e)}}(),s.return){var c=function(e){try{r.done||s.return()}catch(e){}return e};if(i&&i.then)return i.then(c,(function(e){throw c(e)}));c()}return i}if(!("length"in e))throw new TypeError("Object is not iterable");for(var a=[],u=0;u<e.length;u++)a.push(e[u]);return function(e,t,n){var r,i,o=-1;return function n(s){try{for(;++o<e.length;)if((s=t(o))&&s.then){if(!ce(s))return void s.then(n,i||(i=oe.bind(null,r=new se,2)));s=s.v}r?oe(r,1,s):r=s}catch(e){oe(r||(r=new se),2,e)}}(),r}(a,(function(e){return t(a[e])}))}(i,(function(e){return Promise.resolve(n.storage.loadChunk(e)).then((function(e){r.push(e),t.push.apply(t,e.parents)}))}));return o&&o.then?o.then(e):e()}));return Promise.resolve(s&&s.then?s.then((function(){return r})):r)}catch(e){return Promise.reject(e)}},n.applyTransaction=function(e,n){try{var r=this,i=Object.keys(n.chunks).map((function(e){return n.chunks[e]}));if(!i)return Promise.resolve();var o=r.spaces.getLoaded(e);if(!o)throw new T(e);var s=i.some((function(e){return!e.parents.length}));return i.forEach(s?function(e){return e.type=t.ChunkType.Snapshot}:function(e){return e.type=t.ChunkType.Incremental}),Promise.resolve(Promise.all(i.map((function(e){return r.storage.saveChunk(e)})))).then((function(){return i.forEach((function(e){return r.storage.removeTemporalChunk(e.id)})),r.spaces.updateSpaceRef(o.id,n.refs.get(e))}))}catch(e){return Promise.reject(e)}},e}(),he=function(){function e(){this.chunks=new Map,this.spaces=new Map}var t=e.prototype;return t.loadChunk=function(e){try{if(this.chunks.has(e))return Promise.resolve(this.chunks.get(e));throw new D(e)}catch(e){return Promise.reject(e)}},t.saveChunk=function(e){try{return this.chunks.set(e.id,e),Promise.resolve(e)}catch(e){return Promise.reject(e)}},t.markDraftChunkAsUnused=function(e){try{return this.chunks.delete(e),Promise.resolve()}catch(e){return Promise.reject(e)}},t.setChunks=function(e){var t=this;e.forEach((function(e){return t.chunks.set(e.id,e)}))},t.clearChunks=function(){try{return this.chunks.clear(),Promise.resolve()}catch(e){return Promise.reject(e)}},t.reset=function(e){this.chunks.clear(),this.setChunks(e)},t.removeChunk=function(e){try{return this.chunks.delete(e),Promise.resolve()}catch(e){return Promise.reject(e)}},t.createSpace=function(e){try{if(this.spaces.has(e.id))throw new C('Can not create space "'+e.id+'": already exists');return this.spaces.set(e.id,e),Promise.resolve(e)}catch(e){return Promise.reject(e)}},t.loadSpace=function(e){try{return Promise.resolve(this.spaces.get(e))}catch(e){return Promise.reject(e)}},t.saveSpace=function(e){try{return this.spaces.set(e.id,e),Promise.resolve(e)}catch(e){return Promise.reject(e)}},t.updateSpace=function(e,t){try{var n=this.spaces.get(e);if(!n)throw new C('Can not update space "'+e+'": not exists');return this.spaces.set(e,p({},n,{ref:t})),Promise.resolve(n)}catch(e){return Promise.reject(e)}},t.clearSpaces=function(){try{return this.spaces.clear(),Promise.resolve()}catch(e){return Promise.reject(e)}},t.getAllSpaces=function(){try{return Promise.resolve(Array.from(this.spaces.values()))}catch(e){return Promise.reject(e)}},e}();t.AbstractChunk=l,t.ChunkDB=ue,t.CollectionConfig=function(e,n){if(this.name=e,this.indexedFields=[],this.priority=t.Priority.Normal,this.indexedFields=n.indexedFields||this.indexedFields,this.priority=n.priority||this.priority,"factory"in n)this.factory=n.factory;else{if(!("constructor"in n))throw new Error("Invalid collection config");this.factory=function(e){return new n.constructor(e)}}},t.Cursor=z,t.DataSpace=ee,t.InMemoryChunkStorage=he,t.IncrementalChunk=x,t.MergeChunk=S,t.Model=J,t.NotFoundChunkError=D,t.Query=Y,t.SnapshotChunk=j,t.Space=ne,t.TemporaryTransactionChunk=P,t.UpdateChunk=Z,t.arrayToMap=a,t.arrayToObject=function(e){var t={};return e.forEach((function(e){return t[e._id]=e})),t},t.calculateSizes=h,t.chunkDataToMap=s,t.chunkFactory=k,t.delay=function(e){return void 0===e&&(e=0),new Promise((function(t){return setTimeout(t,e)}))},t.isGenericChunk=u,t.makeChunkID=function(e){return e},t.makeSpaceID=function(e){return e},t.makeSubscription=X,t.mapToArray=function(e){return e?Array.from(e.values()):[]},t.objectToArray=function(e){return Object.keys(e).map((function(t){return e[t]}))},t.objectToMap=c},7648:function(e,t,n){var r=n(5292);t.s=function(){function e(e,t){if(void 0===t&&(t={}),this.dbName=e,this.prefix=t.prefix||"chunk-db-",this.spacesCollection=t.spacesCollection||"chunk-db-spaces",this.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,!this.indexedDB)throw new Error("Fatal error: Your platform not supports IndexedDB")}var t,n=e.prototype;return n.connect=function(){var e=this;return new Promise((function(t,n){var r=e.indexedDB.open(e.dbName,1);r.addEventListener("success",(function(){e.db=r.result,console.log("successful connect to DB"),t()}),{once:!0}),r.addEventListener("error",n,{once:!0}),r.addEventListener("upgradeneeded",(function(t){var n=t.target.result;console.log("upgrade",n),n.createObjectStore(e.spacesCollection,{keyPath:"id"}),n.createObjectStore(e.chunkStorageName,{keyPath:"id"})}),{once:!0}),r.addEventListener("blocked",(function(){return n(new Error("IndexedDB blocked"))}),{once:!0})}))},n.loadChunk=function(e){var t=this;return console.log('REAL LOAD CHUNK "'+e+'"'),new Promise((function(n,r){if(!t.db)return r(new Error("DB not init"));var i=t.db.transaction(t.chunkStorageName,"readwrite").objectStore(t.chunkStorageName).get(e);i.addEventListener("success",(function(){return n(i.result)}),{once:!0}),i.addEventListener("error",r,{once:!0})}))},n.saveChunk=function(e){var t=this;return console.log('SAVE CHUNK "'+e.id+'"'),new Promise((function(n,r){if(!t.db)return r(new Error("DB not init"));console.log("idb:",t.db);var i=t.db.transaction(t.chunkStorageName,"readwrite");i.addEventListener("complete",(function(){return n(e)}),{once:!0}),i.addEventListener("error",(function(){return r(e)}),{once:!0}),i.objectStore(t.chunkStorageName).put(e)}))},n.markDraftChunkAsUnused=function(e){return console.log('MARK UNUSED CHUNK "'+e+'"'),Promise.resolve(void 0)},n.loadSpace=function(e){var t=this;return console.log("LOAD SPACE "+e),new Promise((function(n,r){if(!t.db)return r(new Error("DB not init"));var i=t.db.transaction([t.spacesCollection],"readwrite").objectStore(t.spacesCollection).get(e);i.addEventListener("success",(function(){return n(i.result)}),{once:!0}),i.addEventListener("error",r,{once:!0})}))},n.saveSpace=function(e){var t=this;return console.log("SAVE SPACE "+e.id),e instanceof r.Space||(e=new r.Space(e)),new Promise((function(n,r){if(!t.db)return r(new Error("DB not init"));console.log("idb:",t.db);var i=t.db.transaction(t.spacesCollection,"readwrite");i.addEventListener("complete",(function(){return n(e)}),{once:!0}),i.addEventListener("error",(function(){return r(e)}),{once:!0}),i.objectStore(t.spacesCollection).put(e)}))},(t=[{key:"chunkStorageName",get:function(){return this.prefix+"chunks"}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(e.prototype,t),e}()},8079:function(e,t,n){var r=n(5292),i=n(2784),o=i.createContext(null),s=o.Provider;function c(){return i.useContext(o)}function a(e){var t=c(),n=i.useState(void 0),o=n[0],s=n[1];return i.useEffect((function(){if(t&&e)return s(new r.DataSpace(t,e)),t.spaces.subscribe(e,(function(){return s(new r.DataSpace(t,e))}))}),[t,e]),o}t.gt=s,t.zh=c,t.Ke=function(e,t,n){var r=i.useState([]),o=r[0],s=r[1],u=c(),h=a(e);return i.useEffect((function(){h&&u.ready&&u.getFlatChain(h.ref,n).then((function(e){return s(e)}))}),[u,h,t,n]),o},t.hT=function(e,t,n){void 0===n&&(n=null);var o=[].slice.call(arguments,3),s=i.useState([n,!0]),u=s[0],h=s[1],l=c(),f=a(e);return i.useEffect((function(){if(f&&l.ready){var e=t.apply(void 0,[f].concat(o));e instanceof r.Query?e.exec().all().then((function(e){return h([e,!1])})):e.then((function(e){return h([e,!1])}))}}),[f].concat(o)),u},t.$_=a}},function(e){e.O(0,[774,422,281,888,179],(function(){return t=3354,e(e.s=t);var t}));var t=e.O();_N_E=t}]);